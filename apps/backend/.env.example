# =================================================================
# AI 智能体配置 (Example Agent)
# =================================================================

# Provider ID（Mastra 内置 Provider Registry 的标识；DeepSeek 用 deepseek）
AI_EXAMPLE_AGENT_PROVIDER_ID=deepseek

# AI 模型名称 (例如: deepseek-chat, gpt-4)
AI_EXAMPLE_AGENT_MODEL_NAME=deepseek-chat
# AI API 基础地址 (兼容 OpenAI 格式的 API 接口地址)
AI_EXAMPLE_AGENT_API_URL=https://api.deepseek.com/v1
# AI API 访问密钥 (请在此处填入你的密钥)
AI_EXAMPLE_AGENT_API_KEY=your-api-key-here
# Example Agent 记忆保留的最后消息数（Mastra Memory），默认 20
AI_EXAMPLE_AGENT_MEMORY_LAST_MESSAGES=20








# ========== 下面保持默认即可







# =================================================================
# 后端服务基础配置
# =================================================================

# 服务监听端口
PORT=3000

# 运行环境: development | production | test
NODE_ENV=development

# Express 信任反向代理的层数（例如 Nginx 反代通常设为 1）
TRUST_PROXY=1

# 跨域允许源: 多个地址用逗号分隔，或使用 '*' 允许所有
CORS_ORIGINS=http://localhost:3000,http://localhost:5173,http://localhost:5174

# CORS 预检请求缓存时间（秒），默认 86400（24 小时）
CORS_MAX_AGE=86400

# =================================================================
# Auth 配置（JWT）
# =================================================================

# 是否强制鉴权（true=所有受保护接口必须带 Authorization；false=宽松模式，缺失 token 也允许）
# 默认值: true
AUTH_REQUIRED=true

# JWT 签名密钥（HS256）
# - production 环境必须配置，否则服务启动失败
# - development/test 未配置时会自动生成临时密钥（仅用于本机开发）
# 建议使用高强度随机字符串（至少 32 字符）
AUTH_JWT_SECRET=your-strong-jwt-secret-here

# 匿名会话 token 有效期（秒），默认 3600（1 小时）
AUTH_JWT_TTL_SECONDS=3600

# =================================================================
# Mastra 平台配置
# =================================================================

# Mastra 内部服务端口
MASTRA_SERVER_PORT=3002

# Mastra 服务监听主机
MASTRA_HOST=localhost

# Mastra Studio 的访问基础路径
MASTRA_STUDIO_BASE=/my-mastra-studio

# Mastra 存储位置（用于 LibSQLStore）
# - 本地模式：目录路径（用于存放 *.db 文件），留空则使用默认值：${cwd}/mastra-memory
# - 远程模式：LibSQL URL（例如 libsql://xxx.turso.io 或 https://...）
MASTRA_STORAGE_PATH=
# 远程模式可选：LibSQL auth token（本地模式无需）
MASTRA_STORAGE_TOKEN=


# =================================================================
# 限流配置（Rate Limit）
# =================================================================

# SSE 连接限流：时间窗口（毫秒），默认 1 分钟
RATE_LIMIT_SSE_WINDOW_MS=600000

# SSE 连接限流：时间窗口内最大连接数（生产环境）
RATE_LIMIT_SSE_MAX_PRODUCTION=5

# SSE 连接限流：时间窗口内最大连接数（开发环境）
RATE_LIMIT_SSE_MAX_DEVELOPMENT=50

# AI 聊天限流：时间窗口（毫秒），默认 1 分钟
RATE_LIMIT_AI_CHAT_WINDOW_MS=600000

# AI 聊天限流：时间窗口内最大请求数（生产环境）
RATE_LIMIT_AI_CHAT_MAX_PRODUCTION=10

# AI 聊天限流：时间窗口内最大请求数（开发环境）
RATE_LIMIT_AI_CHAT_MAX_DEVELOPMENT=100

# Auth Session 限流：时间窗口（毫秒），默认 1 分钟
RATE_LIMIT_AUTH_WINDOW_MS=60000

# Auth Session 限流：时间窗口内最大请求数（生产环境）
RATE_LIMIT_AUTH_MAX_PRODUCTION=30

# Auth Session 限流：时间窗口内最大请求数（开发环境）
RATE_LIMIT_AUTH_MAX_DEVELOPMENT=100

# =================================================================
# HTTP 配置
# =================================================================

# 请求体大小限制（例如: 10mb, 50mb）
HTTP_BODY_LIMIT=10mb

# 响应压缩阈值（字节），默认 1KB
HTTP_COMPRESSION_THRESHOLD=1024

# =================================================================
# OSM / Overpass 配置
# =================================================================

# Overpass API 端点（默认使用 Mail.ru 镜像）
OSM_OVERPASS_ENDPOINT=https://maps.mail.ru/osm/tools/overpass/api/interpreter

# Overpass 请求超时（毫秒），默认 20000
OSM_OVERPASS_TIMEOUT_MS=2000000

# Overpass 最大重试次数（不含首请求），默认 2
OSM_OVERPASS_MAX_RETRIES=2

# =================================================================
# OSM Cache（SQLite）配置
# =================================================================

# SQLite DB 文件路径（推荐绝对路径）
# 留空则使用默认值：${cwd}/osm-cache.db（通常 cwd 为 apps/backend）
OSM_CACHE_DB_PATH=

# 缓存最大体积（bytes），默认 1073741824（1GB）
# 设为 0 可视为禁用缓存
OSM_CACHE_MAX_BYTES=1073741824

# 缓存固定过期时间（天），从写入开始计算（fixed TTL）
# 默认 30；允许小数（便于手动验证过期逻辑）
OSM_CACHE_TTL_DAYS=30

# =================================================================
# Runtime Assets 配置（themes / fonts 等）
# =================================================================

# 运行时资产目录（themes-v1 / fonts 等）
# 默认值：${cwd}/runtime-assets（通常 cwd 为 apps/backend）
# RUNTIME_ASSETS_DIR=./runtime-assets

# 海报产物（SVG/PNG）存储目录
# 默认值：${cwd}/poster-assets（通常 cwd 为 apps/backend）
# POSTER_ASSETS_DIR=./poster-assets

# 海报导出 PNG 输出 DPI（默认 300）
POSTER_PNG_DPI=150

# 海报投影模式：webmercator | linear（默认 webmercator）
POSTER_PROJECTION_MODE=linear

# 海报 Worker 池大小（并行渲染线程数），默认 1
# 2G2C 服务器建议 1；4G4C 可设为 2
POSTER_WORKER_POOL_SIZE=1

# 每个 Worker 的最大老生代内存（MB），默认 256
# 2G2C 服务器建议 256；4G+ 可设为 512
POSTER_WORKER_MEMORY_LIMIT_MB=256

# 每个图层最大 feature 数量（安全兜底，防止大城市数据爆炸），默认 50000
# 超出部分会被截断；50000 足够保证海报视觉效果
POSTER_MAX_FEATURES_PER_LAYER=50000

# =================================================================
# Geocoding（Nominatim）配置
# =================================================================

# Nominatim Search API endpoint（可替换为自建/第三方实例）
NOMINATIM_ENDPOINT=https://nominatim.openstreetmap.org/search

# 请求超时（毫秒）
NOMINATIM_TIMEOUT_MS=100000

# User-Agent（建议包含产品名与可联系信息，符合 Nominatim 使用政策）
NOMINATIM_USER_AGENT=map-to-poster-with-ai/1.0

# Geocode bbox 中心点缩放比例（小数）
# 最终 bbox 的宽/高 = 原始 bbox 宽/高 × scale
# 范围：0 < scale <= 1，默认 0.5
GEOCODE_BBOX_CENTER_SCALE=0.3

# Geocode bbox 最大半径（km，近似）
# 用于限制最终 bbox 的最大范围（聚焦中心点并降低 OSM 数据量）。
# 说明：会按 centerLat 做近似换算（1°≈111.32km；经度额外除以 cos(lat)）。
# 默认 50（≈中心点周围 50km）
GEOCODE_BBOX_MAX_RADIUS_KM=15

# =================================================================
# SSE 配置
# =================================================================

# SSE 重试时间（毫秒），客户端收到后应等待此时间后重连
SSE_RETRY_TIME=3000

# SSE 心跳间隔时间（毫秒），默认 30 秒
SSE_HEARTBEAT_INTERVAL=30000

# SSE 并发连接保护（进程内生效）
# 总并发 SSE 连接上限
# 建议与 EVENT_STORE_MAX_SESSIONS 对齐（若每个连接都使用不同 sessionId），避免事件存储超限
SSE_MAX_CONNECTIONS_TOTAL=1000
# 单 IP 并发 SSE 连接上限（避免单点滥用）
SSE_MAX_CONNECTIONS_PER_IP=50
# 单 sessionId 并发 SSE 连接上限（避免重复订阅）
SSE_MAX_CONNECTIONS_PER_SESSION=5

# =================================================================
# 事件存储配置
# =================================================================

# 事件历史记录限制，保留最近 N 个事件（用于断线重连）
EVENT_HISTORY_LIMIT=100

# 最大会话数（LRU），默认 1000
EVENT_STORE_MAX_SESSIONS=1000

# 会话过期时间（毫秒），默认 30 分钟
EVENT_STORE_SESSION_TTL=1800000

# 清理间隔（毫秒），默认 1 分钟
EVENT_STORE_CLEANUP_INTERVAL=60000

# =================================================================
# 应用配置
# =================================================================

# 强制退出超时时间（毫秒），默认 10 秒
APP_FORCE_EXIT_TIMEOUT=10000
